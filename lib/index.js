import{ApolloError as G,ApolloLink as Q}from"@apollo/client/core";import w from"zen-observable";function c(r){return r.query.definitions.find(e=>e.kind==="OperationDefinition")}function l(r,e){let n=e.attachBreadcrumbs,t=c(r),i={},o=e.uri;o&&(i.url=o);let s=t.name?.value;return s&&(i.operationName=s),n.includeVariables&&(i.variables=r.variables),{type:"http",category:`graphql.${t.operation}`,data:i}}var m={shouldHandleOperation:void 0,uri:void 0,setSpan:!0,setFingerprint:!0,attachBreadcrumbs:{includeVariables:!1,includeError:!1,transform:void 0}};function b(r){return{...m,...r,attachBreadcrumbs:{...m.attachBreadcrumbs,...r.attachBreadcrumbs}}}import{addBreadcrumb as L,configureScope as S,getCurrentHub as k}from"@sentry/browser";function h(r){let e={};for(let[n,t]of Object.entries(r))e[n]=typeof t=="object"?F(t):t;return e}function F(r){return JSON.stringify(r,null,2)}function B(r){let n=c(r).name;if(n){let i=k().getScope();if(!i)return;let o=i.getTransaction();return o?o.startChild({op:"apollo.request",description:"Apollo request: "+n.value}):void 0}}var v="{{ default }}";function O(r){let n=c(r).name;n&&S(t=>{t.setFingerprint([v,n.value])})}function d(r,e,n){let t=n.attachBreadcrumbs&&typeof n.attachBreadcrumbs.transform=="function"?n.attachBreadcrumbs.transform(e,r):e;t.data=h(t.data),L(t)}var f=class extends Q{options;constructor(e={}){super(),this.options=b(e)}request(e,n){let t=this.options;if(!(t.shouldHandleOperation?.(e)??!0))return n(e);let i;t.setSpan&&(i=B(e)),t.setFingerprint&&O(e);let o=t.attachBreadcrumbs,s=o?l(e,t):void 0;return new w(u=>{let x=n(e).subscribe({next:a=>{o&&(s.level=N(a),o.includeError&&a.errors&&a.errors.length>0&&(s.data.error=new G({graphQLErrors:a.errors}))),u.next(a)},complete:()=>{o&&d(e,s,t),t.setSpan&&i?.finish?.(),u.complete()},error:a=>{if(o){s.level="error";let p;if(R(a)){let{result:D,response:A,...g}=a;p=g}else p=a;o.includeError&&(s.data.error=p),d(e,s,t)}t.setSpan&&i?.finish?.(),u.error(a)}});return()=>{x.unsubscribe()}})}};function R(r){return typeof r=="object"&&r!==null&&"response"in r&&"result"in r&&"statusCode"in r}function N(r){return r.errors&&r.errors.length>0?"error":"info"}var y=r=>r.category==="fetch"&&(r.data?.url??"").includes("/ws.php")?null:r;function E(r){return(e,n)=>{let t=y(e,n);return t===null?null:r(t,n)}}export{f as SentryLink,y as excludeGraphQLFetch,E as withoutGraphQLFetch};
