import{ApolloError as G,ApolloLink as Q}from"@apollo/client/core";import w from"zen-observable";function u(r){return r.query.definitions.find(e=>e.kind==="OperationDefinition")}function l(r,e){let n=e.attachBreadcrumbs,t=u(r),a={},o=e.uri;o&&(a.url=o);let s=t.name?.value;return s&&(a.operationName=s),n.includeVariables&&(a.variables=r.variables),{type:"http",category:`graphql.${t.operation}`,data:a}}var m={shouldHandleOperation:void 0,uri:void 0,setSpan:!0,setFingerprint:!0,attachBreadcrumbs:{includeVariables:!1,includeError:!1,transform:void 0}};function b(r){return{...m,...r,attachBreadcrumbs:{...m.attachBreadcrumbs,...r.attachBreadcrumbs}}}import{addBreadcrumb as F,configureScope as S,getCurrentHub as k}from"@sentry/browser";function h(r){let e={};for(let[n,t]of Object.entries(r))e[n]=typeof t=="object"?L(t):t;return e}function L(r){return JSON.stringify(r,null,2)}function B(r){let n=u(r).name;if(n){let a=k().getScope();if(!a)return;let o=a.getTransaction();return o?o.startChild({op:"apollo.request",description:"Apollo request: "+n.value}):void 0}}var v="{{ default }}";function O(r){let n=u(r).name;n&&S(t=>{t.setFingerprint([v,n.value])})}function f(r,e,n){let t=n.attachBreadcrumbs&&typeof n.attachBreadcrumbs.transform=="function"?n.attachBreadcrumbs.transform(e,r):e;t.data=h(t.data),F(t)}var c=class extends Q{options;constructor(e={}){super(),this.options=b(e)}request(e,n){let t=this.options;if(!(t.shouldHandleOperation?.(e)??!0))return n(e);let a;t.setSpan&&(a=B(e)),t.setFingerprint&&O(e);let o=t.attachBreadcrumbs,s=o?l(e,t):void 0;return new w(p=>{let x=n(e).subscribe({next:i=>{o&&(s.level=N(i),o.includeError&&i.errors&&i.errors.length>0&&(s.data.error=new G({graphQLErrors:i.errors}))),p.next(i)},complete:()=>{o&&f(e,s,t),t.setSpan&&a?.finish?.(),p.complete()},error:i=>{if(o){s.level="error";let d;if(R(i)){let{result:D,response:A,...g}=i;d=g}else d=i;o.includeError&&(s.data.error=d),f(e,s,t)}t.setSpan&&a?.finish?.(),p.error(i)}});return()=>{x.unsubscribe()}})}};function R(r){return typeof r=="object"&&r!==null&&"response"in r&&"result"in r&&"statusCode"in r}function N(r){return r.errors&&r.errors.length>0?"error":"info"}var y=r=>r.category==="fetch"&&(r.data?.url??"").includes("/ws.php")?null:r;function E(r){return(e,n)=>{let t=y(e,n);return t===null?null:r(t,n)}}export{c as SentryLink,c as default,y as excludeGraphQLFetch,E as withoutGraphQLFetch};
